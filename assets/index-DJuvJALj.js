import{r as ie,a as le,g as de}from"./react-Dazix4UH.js";import{r as N,X as me,R as ue}from"./icons-0M8yZXYh.js";import{_ as Z}from"./pdf-CKwH0W_y.js";import{i as fe,g as pe}from"./firebase-6rmv2JEA.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))T(c);new MutationObserver(c=>{for(const u of c)if(u.type==="childList")for(const j of u.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&T(j)}).observe(document,{childList:!0,subtree:!0});function I(c){const u={};return c.integrity&&(u.integrity=c.integrity),c.referrerPolicy&&(u.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?u.credentials="include":c.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function T(c){if(c.ep)return;c.ep=!0;const u=I(c);fetch(c.href,u)}})();var z={exports:{}},L={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B;function xe(){if(B)return L;B=1;var g=ie(),o=Symbol.for("react.element"),I=Symbol.for("react.fragment"),T=Object.prototype.hasOwnProperty,c=g.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function j(i,m,x){var y,A={},R=null,P=null;x!==void 0&&(R=""+x),m.key!==void 0&&(R=""+m.key),m.ref!==void 0&&(P=m.ref);for(y in m)T.call(m,y)&&!u.hasOwnProperty(y)&&(A[y]=m[y]);if(i&&i.defaultProps)for(y in m=i.defaultProps,m)A[y]===void 0&&(A[y]=m[y]);return{$$typeof:o,type:i,key:R,ref:P,props:A,_owner:c.current}}return L.Fragment=I,L.jsx=j,L.jsxs=j,L}var H;function he(){return H||(H=1,z.exports=xe()),z.exports}var a=he(),$={},K;function ge(){if(K)return $;K=1;var g=le();return $.createRoot=g.createRoot,$.hydrateRoot=g.hydrateRoot,$}var ye=ge();const we=de(ye),ve="/restroom-tracker/assets/school_logo-DCVkbtNk.png";function Se({children:g,className:o}){return a.jsx("div",{className:`bg-white rounded-lg ${o}`,children:g})}function be({children:g,className:o}){return a.jsx("div",{className:`${o}`,children:g})}function O({children:g,className:o,onClick:I}){return a.jsx("button",{onClick:I,className:`px-3 py-2 rounded ${o}`,children:g})}const je={apiKey:"AIzaSyDaOW67xk6M373a_mblBfYqzwSg77gPLw4",authDomain:"restroom-tracker-c16a4.firebaseapp.com",projectId:"restroom-tracker-c16a4",storageBucket:"restroom-tracker-c16a4.firebasestorage.app",messagingSenderId:"917504164761",appId:"1:917504164761:web:8133bcc5c0f4cc17bc0908",measurementId:"G-5X47ETGYTF"},_e=fe(je),k=pe(_e);function Ne({children:g}){const o="fc4ec433f9f79454a7e4588eff2d3ff9e3a1f062af1dd806a06e8d839387b386",[I,T]=N.useState(!1),[c,u]=N.useState("");N.useEffect(()=>{const m=sessionStorage.getItem("rt_gate_ok")==="1";T(m)},[]);async function j(m){const x=new TextEncoder().encode(m),y=await crypto.subtle.digest("SHA-256",x);return Array.from(new Uint8Array(y)).map(A=>A.toString(16).padStart(2,"0")).join("")}async function i(m){m.preventDefault(),await j(c)===o?(sessionStorage.setItem("rt_gate_ok","1"),T(!0)):alert("Incorrect password.")}return I?g:a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 p-6",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 w-full max-w-sm space-y-4",children:[a.jsx("h1",{className:"text-xl font-semibold text-center",children:"Enter Password"}),a.jsxs("form",{onSubmit:i,className:"space-y-3",children:[a.jsx("input",{type:"password",className:"w-full border rounded p-2",placeholder:"Password",value:c,onChange:m=>u(m.target.value),autoFocus:!0}),a.jsx("button",{type:"submit",className:"w-full bg-black text-white rounded p-2",children:"Unlock"})]}),a.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Protected access"})]})})}async function E(){return await Z(()=>import("./firebase-6rmv2JEA.js").then(g=>g.a),[])}function De(){const g="2022",[o,I]=N.useState({"Lizette Lozano":["Abner M.","Alexia P.","Angel C.","Carter W.","Emaily C.","Genesis P.","Jonathan E."],"Yadira Reina":["Sofia A.","Issac G.","Marisa P.","Ariana R.","Alondra C.","Thanh D.","Maya F.","Samuel S.","Abner M.","Angel C."]}),[T,c]=N.useState({}),[u,j]=N.useState([]),[i,m]=N.useState(""),[x,y]=N.useState(""),[A,R]=N.useState("");function P(){return new Intl.DateTimeFormat("en-US",{timeZone:"America/Los_Angeles",weekday:"long",year:"numeric",month:"long",day:"numeric"}).format(new Date)}function F(){const t=new Intl.DateTimeFormat("en-CA",{timeZone:"America/Los_Angeles",year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(new Date),r=t.find(p=>p.type==="year").value,e=t.find(p=>p.type==="month").value,f=t.find(p=>p.type==="day").value;return`${r}-${e}-${f}`}function G(){const t=new Date,r=new Intl.DateTimeFormat("en-US",{timeZone:"America/Los_Angeles",weekday:"short"}).format(t),p=({Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6}[r.slice(0,3)]+6)%7,S=new Date(t);S.setDate(t.getDate()-p);const h=new Date(S);h.setDate(S.getDate()+4);const b=new Intl.DateTimeFormat("en-US",{timeZone:"America/Los_Angeles",month:"long"}),D=new Intl.DateTimeFormat("en-US",{timeZone:"America/Los_Angeles",day:"numeric"}),l=new Intl.DateTimeFormat("en-US",{timeZone:"America/Los_Angeles",year:"numeric"}),_=b.format(S),w=b.format(h),n=D.format(S),C=D.format(h),s=l.format(S),d=l.format(h);return s===d?_===w?`${_} ${n}–${C}, ${s}`:`${_} ${n}–${w} ${C}, ${s}`:`${_} ${n}, ${s}–${w} ${C}, ${d}`}const[W,Y]=N.useState(P());N.useEffect(()=>{const t=F(),r=localStorage.getItem("rt_pacific_date");r!==t&&((async()=>{try{if(r){const{collection:f,query:p,where:S,getDocs:h,deleteDoc:b}=await E(),D=p(f(k,"rt_logs"),S("dateKey","==",r)),l=await h(D);for(const _ of l.docs)await b(_.ref)}}catch(f){console.warn("Cleanup failed",f)}})(),j([]),c({}),localStorage.setItem("rt_pacific_date",t)),Y(P());const e=setInterval(()=>{const f=F(),p=localStorage.getItem("rt_pacific_date");f!==p&&(j([]),c({}),localStorage.setItem("rt_pacific_date",f),Y(P()))},6e4);return()=>clearInterval(e)},[]),N.useEffect(()=>{let t=()=>{};return(async()=>{const{collection:r,query:e,where:f,orderBy:p,onSnapshot:S}=await E(),h=F(),b=e(r(k,"rt_logs"),f("dateKey","==",h),p("ts","asc"));t=S(b,D=>{const _=D.docs.map(n=>({id:n.id,...n.data()})).map(n=>({id:n.id,teacher:n.teacher,name:n.name,action:n.action,time:n.ts&&n.ts.toDate?new Date(n.ts.toDate()).toLocaleTimeString():new Date().toLocaleTimeString()}));j(_);const w={};_.forEach(n=>{n.action==="OUT"?w[n.name]=n.time:n.action==="IN"&&delete w[n.name]}),c(w)})})(),()=>t()},[W]);const U=()=>window.prompt("Enter PIN")===g,q=i&&x&&!T[x]&&o[i]?.includes(x),M=i&&x&&!!T[x]&&o[i]?.includes(x),J=async()=>{if(!q)return;const{addDoc:t,collection:r,serverTimestamp:e}=await E();await t(r(k,"rt_logs"),{dateKey:F(),teacher:i,name:x,action:"OUT",ts:e()})},V=async()=>{if(!M)return;const{addDoc:t,collection:r,serverTimestamp:e}=await E();await t(r(k,"rt_logs"),{dateKey:F(),teacher:i,name:x,action:"IN",ts:e()})},X=()=>{if(!i||!A.trim())return;if(!U())return alert("Incorrect PIN.");const t=A.trim();if(o[i].includes(t)){alert("Student already exists.");return}I({...o,[i]:[...o[i],t].sort((r,e)=>r.localeCompare(e))}),R("")},Q=t=>{if(i){if(!U())return alert("Incorrect PIN.");I({...o,[i]:o[i].filter(r=>r!==t).sort((r,e)=>r.localeCompare(e))}),x===t&&y("")}},ee=async t=>{const r=u.filter(S=>S.teacher===t);if(r.length===0)return;if(!U())return alert("Incorrect PIN.");const e=r[r.length-1];if(!e.id)return;const{deleteDoc:f,doc:p}=await E();await f(p(k,"rt_logs",e.id))},te=async t=>{const{default:r}=await Z(async()=>{const{default:d}=await import("./pdf-CKwH0W_y.js").then(v=>v.j);return{default:d}},[]),e=new r;e.setFont("helvetica","bold"),e.setFontSize(16);const f=`Restroom Activity Log | ${t} (${G()})`,p=e.internal.pageSize.getWidth();e.text(f,p/2,18,{align:"center"});const S=u.filter(d=>d.teacher===t),h={},b=[],D=new Intl.DateTimeFormat("en-US",{timeZone:"America/Los_Angeles",month:"numeric",day:"numeric",year:"2-digit"}).format(new Date);if(S.forEach(d=>{const v=d.name;d.action==="OUT"?(h[v]&&b.push({name:v,date:D,out:h[v],in:""}),h[v]=d.time):d.action==="IN"&&(h[v]?(b.push({name:v,date:D,out:h[v],in:d.time}),delete h[v]):b.push({name:v,date:D,out:"",in:d.time}))}),Object.keys(h).forEach(d=>{b.push({name:d,date:D,out:h[d],in:""})}),b.length===0){e.setFont("helvetica","normal"),e.setFontSize(12),e.text("No activity recorded.",20,30),e.save(`${t}_restroom_log.pdf`);return}const l=15,_=30,w=8,n={num:12,name:60,date:36,out:36,in:36},C=n.num+n.name+n.date+n.out+n.in;let s=_;e.setFont("helvetica","bold"),e.setFontSize(12),e.setFillColor(60,60,60),e.setTextColor(255,255,255),e.rect(l,s-w+2,C,w,"F"),e.text("#",l+3,s),e.text("Name",l+n.num+3,s),e.text("Date",l+n.num+n.name+3,s),e.text("Time Out",l+n.num+n.name+n.date+3,s),e.text("Time In",l+n.num+n.name+n.date+n.out+3,s),e.setTextColor(0,0,0),e.setFont("helvetica","normal"),b.forEach((d,v)=>{s+=w,s>e.internal.pageSize.getHeight()-15&&(e.addPage(),s=_,e.setFont("helvetica","bold"),e.setFillColor(60,60,60),e.setTextColor(255,255,255),e.rect(l,s-w+2,C,w,"F"),e.text("#",l+3,s),e.text("Name",l+n.num+3,s),e.text("Date",l+n.num+n.name+3,s),e.text("Time Out",l+n.num+n.name+n.date+3,s),e.text("Time In",l+n.num+n.name+n.date+n.out+3,s),e.setTextColor(0,0,0),e.setFont("helvetica","normal")),v%2===0&&(e.setFillColor(245,245,245),e.rect(l,s-w+2,C,w,"F"));const ae=l+3,re=l+n.num+3,se=l+n.num+n.name+3,oe=l+n.num+n.name+n.date+3,ce=l+n.num+n.name+n.date+n.out+3;e.text(String(v+1),ae,s),e.text(d.name,re,s),e.text(d.date,se,s),e.text(d.out||"-",oe,s),e.text(d.in||"-",ce,s)}),e.save(`${t}_restroom_log.pdf`)},ne=t=>{const r=u.filter(e=>e.teacher===t);return r.length===0?a.jsx("p",{className:"text-gray-500",children:"No activity yet"}):r.map((e,f)=>{const p=f===r.length-1;return a.jsxs("div",{className:"flex justify-between items-center bg-gray-50 p-2 rounded",children:[a.jsxs("span",{className:"font-semibold",children:[f+1,"."]}),a.jsx("span",{children:e.name}),a.jsx("span",{className:e.action==="OUT"?"text-red-500":"text-green-500",children:e.action}),a.jsx("span",{className:"text-gray-400 text-sm",children:e.time}),p&&a.jsx("button",{onClick:()=>ee(t),className:"ml-2 text-red-500 hover:text-red-700",title:"Remove last log",children:a.jsx(me,{size:16})})]},f)})};return a.jsx(Ne,{children:a.jsx("div",{className:"min-h-screen bg-gray-100 p-6 flex flex-col items-center",children:a.jsx(Se,{className:"w-full max-w-3xl",children:a.jsxs(be,{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"flex flex-col items-center mb-4",children:[a.jsx("img",{src:ve,alt:"School Logo",className:"w-32 mb-2"}),a.jsx("h1",{className:"text-3xl font-bold text-center",children:"🚻 Restroom Tracker | Taft DHH"})]}),a.jsxs("div",{className:"mb-2",children:[a.jsxs("h2",{className:"text-xl font-semibold",children:["Activity Log — ",W]}),a.jsx("p",{className:"text-sm text-gray-600",children:"Showing all entries for today. Logs clear automatically daily at 11:59 PM Pacific."})]}),a.jsx("div",{className:"flex space-x-2",children:a.jsxs("select",{className:"p-2 border rounded w-1/2",value:i,onChange:t=>{m(t.target.value),y("")},children:[a.jsx("option",{value:"",children:"-- Teacher --"}),Object.keys(o).sort((t,r)=>t.localeCompare(r)).map(t=>a.jsx("option",{value:t,children:t},t))]})}),i&&a.jsx("div",{className:"flex space-x-2",children:a.jsxs("select",{className:"p-2 border rounded w-1/2",value:x,onChange:t=>y(t.target.value),children:[a.jsx("option",{value:"",children:"-- Student --"}),[...o[i]].sort((t,r)=>t.localeCompare(r)).map(t=>a.jsx("option",{value:t,children:t},t))]})}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx(O,{className:`px-4 py-2 rounded ${q?"bg-red-500 text-white":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,onClick:J,disabled:!q,children:"Out"}),a.jsx(O,{className:`px-4 py-2 rounded ${M?"bg-green-500 text-white":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,onClick:V,disabled:!M,children:"In"})]}),i&&a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("input",{type:"text",className:"p-2 border rounded w-full",placeholder:"Add new student",value:A,onChange:t=>R(t.target.value)}),a.jsx(O,{className:"px-4 py-2 rounded bg-blue-500 text-white",onClick:X,children:"Add"}),x&&a.jsx(O,{className:"px-4 py-2 rounded bg-gray-800 text-white",onClick:()=>Q(x),children:"Remove"})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.keys(o).sort((t,r)=>t.localeCompare(r)).map(t=>a.jsxs("div",{className:"border rounded p-3 bg-white",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("h3",{className:"font-semibold",children:t}),a.jsx(O,{className:"px-3 py-1 bg-gray-200",onClick:()=>te(t),children:"PDF"})]}),a.jsx("div",{className:"space-y-2",children:ne(t)})]},t))})]})})})})}we.createRoot(document.getElementById("root")).render(a.jsx(ue.StrictMode,{children:a.jsx(De,{})}));
